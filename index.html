<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Бланк метеосередній</title>

  <style>
    :root{
      --paper:#fff;
      --bg:#f2f2f2;

      /* ✅ единый цвет линий (бордеров) по всей таблице */
      --grid:#6f6f6f;

      /* ✅ заливка "неактивной" ячейки = цвету бордера */
      --inactive: var(--grid);

      --ink:#111; /* текст */
      --cell:24px; /* фикс высоты строки */
    }

    *{ box-sizing:border-box; }

    html{
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    body{
      margin:0;
      background:var(--bg);
      font-family:"Times New Roman", Times, serif;
      color:var(--ink);
    }

    .page{
      width:210mm;
      min-height:297mm;
      margin:16px auto;
      padding:10mm 10mm;
      background:var(--paper);
      box-shadow:0 10px 35px rgba(0,0,0,.12);
    }

    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      border:2px solid var(--grid);
    }

    th, td{
      border:2px solid var(--grid);
      padding:0;
      vertical-align:middle;
      text-align:center;
      font-size:16px;
      line-height:1;
      height:var(--cell);
      overflow:hidden;
    }

    .title{
      height:70px;
      font-weight:700;
      font-size:20px;
      line-height:1.2;
      text-align:center;
    }

    tr.row{ height:var(--cell); }
    tr.row > td{ height:var(--cell); }

    /* ✅ самая первая ячейка (неактивная) */
    td.is-inactive{
      background:var(--inactive);
      color:#fff;
    }

    /* ===== ЯЧЕЙКА С ВВОДОМ (чтобы выглядело как обычный td) ===== */
    td.has-input{
      padding:0;
      cursor:text;
    }
    .cell-input{
      width:100%;
      height:100%;
      display:block;
      border:0;
      outline:none;
      background:transparent;
      color:var(--ink);
      font:inherit;
      font-size:16px; /* важно: >=16px чтобы iOS не зумил */
      line-height:1;
      text-align:center;
      padding:0;
      margin:0;
      appearance:none;
      -webkit-appearance:none;
      border-radius:0;
      caret-color: var(--ink);
      touch-action: manipulation;
    }
    .cell-input::placeholder{ color:transparent; }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    /* ===== ЗЕЛЁНАЯ объединённая зона (C..H) × 12 строк (1..12) ===== */
    td.zone{
      padding:0;
      vertical-align:top;
    }

    .zone-grid{
      display:grid;
      grid-template-columns: repeat(6, 1fr);  /* C D E F G H */
      grid-template-rows: repeat(12, var(--cell));   /* 1..12 */
      width:100%;
      height: calc(var(--cell) * 12);
    }

    /* ===== вложенные таблицы ===== */
    .mini{
      width:100%;
      height:100%;
      border-collapse:collapse;
      table-layout:fixed;
      border:0;
    }

    .mini td{
      border:2px solid var(--grid);
      padding:0;
      text-align:center;
      vertical-align:middle;
      font-size:16px;
      height:var(--cell);
      line-height:1;
      overflow:hidden;
    }

    /* Позиции блоков как на скрине */
    .t_cd   { grid-column: 1 / span 2; grid-row: 1 / span 6; } /* C1..D6 */
    .t_fgh  { grid-column: 4 / span 3; grid-row: 1 / span 2; } /* F1..H2 */
    .t_gh   { grid-column: 5 / span 2; grid-row: 4 / span 2; } /* G4..H5 */
    .t_h    { grid-column: 6 / span 1; grid-row: 7 / span 2; } /* H7..H8 */
    .t_cdef { grid-column: 1 / span 4; grid-row: 9 / span 4; } /* C9..F12 */

    /* ===== убираем двойные границы по краям зелёной зоны ===== */
    .t_cd  tr:first-child td{ border-top:0; }
    .t_fgh tr:first-child td{ border-top:0; }

    .t_cd   td:first-child{ border-left:0; }
    .t_cdef td:first-child{ border-left:0; }

    .t_fgh td:last-child{ border-right:0; }
    .t_gh  td:last-child{ border-right:0; }
    .t_h   td{ border-right:0; }

    .t_cdef tr:last-child td{ border-bottom:0; }

    /* ===== Панель быстрых символов (появляется при фокусе) ===== */
    .quickkeys{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      z-index:9999;
      background:#fff;
      border-top:2px solid var(--grid);
      box-shadow:0 -10px 25px rgba(0,0,0,.10);
      padding:10px 12px;
      display:none;
      gap:10px;
      justify-content:center;
      align-items:center;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .quickkeys.is-open{ display:flex; }

    .qbtn{
      min-width:64px;
      height:40px;
      padding:0 14px;
      border:2px solid var(--grid);
      border-radius:10px;
      background:#fff;
      font-size:18px;
      line-height:1;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .qbtn:active{ transform:translateY(1px); }
  </style>
</head>

<body>
  <div class="page">
    <table aria-label="Бланк складання наближеного бюлетеня метеосередній">
      <tr>
        <th class="title" colspan="8" data-type="label">
          <div>БЛАНК СКЛАДАННЯ НАБЛИЖЕНОГО БЮЛЕТЕНЯ МЕТЕОСЕРЕДНІЙ</div>
          <div>ЗА ДАНИМИ ДМК</div>
        </th>
      </tr>

      <!-- Ряд 1 -->
      <tr class="row">
        <td rowspan="2" data-type="label">t₀</td>

        <!-- ✅ ввод: оставляем "цифровую" (decimal), а ,/± даём кнопками снизу -->
        <td rowspan="2" class="has-input" data-type="label" data-cell="r1c2">
          <input
            class="cell-input"
            type="text"
            inputmode="decimal"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
            aria-label="Ввід чисел"
          />
        </td>

        <td rowspan="2" data-type="label">H₀</td>
        <td rowspan="2" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td data-type="label"></td>
      </tr>

      <!-- Ряд 2 -->
      <tr class="row">
        <td class="is-inactive" data-type="label"></td>
        <td data-type="label">день</td>
        <td data-type="label">час</td>
        <td data-type="label">хв</td>
      </tr>

      <!-- Ряд 3 -->
      <tr class="row">
        <td rowspan="2" data-type="label">+ΔTᵥ\n(T.1)</td>
        <td rowspan="2" data-type="label"></td>
        <td rowspan="2" data-type="label">-Hno</td>
        <td rowspan="2" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
      </tr>

      <!-- Ряд 4 -->
      <tr class="row">
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td data-type="label"></td>
        <td data-type="label"></td>
      </tr>

      <!-- Ряд 5 -->
      <tr class="row">
        <td rowspan="2" data-type="label">τ₀</td>
        <td rowspan="2" data-type="label"></td>
        <td rowspan="2" data-type="label">ΔH₀</td>
        <td rowspan="2" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td data-type="label">ΔH₀</td>
        <td data-type="label">Δτ₀</td>
      </tr>

      <!-- Ряд 6 -->
      <tr class="row">
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
      </tr>

      <!-- Ряд 7 -->
      <tr class="row">
        <td rowspan="2" data-type="label">-τₙ⁰</td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td data-type="label"></td>
      </tr>

      <!-- Ряд 8 -->
      <tr class="row">
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
        <td data-type="label">h, мп</td>
      </tr>

      <!-- Ряд 9 -->
      <tr class="row">
        <td rowspan="2" data-type="label">Δτ₀\n(T.2)</td>
        <td rowspan="2" data-type="label"></td>
        <td rowspan="2" colspan="3" data-type="label">αw₀ = </td>
        <td rowspan="2" data-type="label">W₀ = </td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
      </tr>

      <!-- Ряд 10 -->
      <tr class="row">
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
      </tr>

      <!-- Ряд 11 -->
      <tr class="row">
        <td rowspan="2" data-type="label">Yб</td>
        <td rowspan="2" data-type="label">Δτᵧ</td>
        <td rowspan="2" data-type="label">Δαwᵧ</td>
        <td rowspan="2" colspan="2" data-type="label">αw₀ − αwᵧ</td>
        <td rowspan="2" data-type="label">Wᵧ = \n(T.3)</td>
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
      </tr>

      <!-- Ряд 12 -->
      <tr class="row">
        <td class="is-inactive" data-type="label"></td>
        <td class="is-inactive" data-type="label"></td>
      </tr>

      <!-- Ряд 13 и ниже -->
      <tr class="row">
        <td data-type="label">200</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">02-</td>
      </tr>

      <tr class="row">
        <td data-type="label">400</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">04-</td>
      </tr>

      <tr class="row">
        <td data-type="label">800</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">08-</td>
      </tr>

      <tr class="row">
        <td data-type="label">1200</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">12-</td>
      </tr>

      <tr class="row">
        <td data-type="label">1600</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">16-</td>
      </tr>

      <tr class="row">
        <td data-type="label">2000</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">20-</td>
      </tr>

      <tr class="row">
        <td data-type="label">2400</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">24-</td>
      </tr>

      <tr class="row">
        <td data-type="label">3000</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">30-</td>
      </tr>

      <tr class="row">
        <td data-type="label">4000</td>
        <td data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label"></td>
        <td data-type="label"></td>
        <td colspan="2" data-type="label">40-</td>
      </tr>
    </table>
  </div>

  <!-- Панель быстрых символов -->
  <div class="quickkeys" id="quickkeys" aria-hidden="true">
    <button class="qbtn" type="button" data-insert=",">,</button>
    <button class="qbtn" type="button" data-insert="±">±</button>
    <button class="qbtn" type="button" data-insert="+">+</button>
    <button class="qbtn" type="button" data-insert="-">−</button>
  </div>

  <script>
    // Чтобы фокус срабатывал даже если тыкнули в сам td
    document.addEventListener('click', (e) => {
      const td = e.target.closest('td.has-input');
      if (!td) return;
      const input = td.querySelector('input.cell-input');
      if (input) input.focus({ preventScroll: true });
    }, { passive: true });

    const quick = document.getElementById('quickkeys');
    let activeInput = null;

    function openQuick() {
      quick.classList.add('is-open');
      quick.setAttribute('aria-hidden', 'false');
    }
    function closeQuick() {
      quick.classList.remove('is-open');
      quick.setAttribute('aria-hidden', 'true');
    }

    function insertAtCursor(input, text) {
      if (!input) return;
      const start = input.selectionStart ?? input.value.length;
      const end   = input.selectionEnd ?? input.value.length;

      const before = input.value.slice(0, start);
      const after  = input.value.slice(end);

      input.value = before + text + after;

      const pos = start + text.length;
      input.setSelectionRange(pos, pos);
      input.dispatchEvent(new Event('input', { bubbles: true }));
      input.focus({ preventScroll: true });
    }

    // Показываем панель при фокусе на любом .cell-input
    document.addEventListener('focusin', (e) => {
      const inp = e.target.closest?.('input.cell-input');
      if (!inp) return;
      activeInput = inp;
      openQuick();
    });

    // Прячем панель, если фокус ушёл вообще с инпутов (клик по пустому месту и т.д.)
    document.addEventListener('focusout', (e) => {
      const goingTo = e.relatedTarget;
      // если уходим на кнопку панели — не закрываем
      if (goingTo && goingTo.closest && goingTo.closest('#quickkeys')) return;

      // небольшая задержка: чтобы клик по кнопке панели успел сработать
      setTimeout(() => {
        const focused = document.activeElement;
        if (!focused || !focused.closest || !focused.closest('input.cell-input')) {
          activeInput = null;
          closeQuick();
        }
      }, 0);
    });

    // Кнопки вставки
    quick.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-insert]');
      if (!btn) return;
      const val = btn.getAttribute('data-insert') || '';
      insertAtCursor(activeInput, val);
    });

    // Лёгкая фильтрация: разрешаем только цифры и нужные символы
    document.addEventListener('input', (e) => {
      const inp = e.target.closest?.('input.cell-input');
      if (!inp) return;

      // разрешено: цифры, пробел, + - , . ±
      const cleaned = inp.value.replace(/[^\d\s+\-.,±]/g, '');
      if (cleaned !== inp.value) {
        const pos = inp.selectionStart ?? cleaned.length;
        inp.value = cleaned;
        inp.setSelectionRange(pos, pos);
      }
    });
  </script>
</body>
</html>
